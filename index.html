<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì œë¡œì›! ìŠ¤ë§ˆíŠ¸í° ë¯¸ì…˜</title>
    
    <!-- ëª¨ë°”ì¼ ì•± ì„¤ì • -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #000; 
            touch-action: manipulation; 
            overscroll-behavior-y: none;
            margin: 0; padding: 0;
            height: 100vh; width: 100vw;
            overflow: hidden;
        }
        
        .neon-yellow { color: #ccff00; }
        .bg-neon-yellow { background-color: #ccff00; }
        .border-neon-yellow { border-color: #ccff00; }
        
        /* ì „ê¸° ìŠ¤íŒŒí¬ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spark-burst {
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 10px #ccff00; }
            50% { transform: scale(1.1); opacity: 0.8; box-shadow: 0 0 30px #fff, 0 0 50px #ccff00; }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 15px #ccff00; }
        }

        @keyframes jitter {
            0% { transform: translate(0,0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
            100% { transform: translate(0,0); }
        }

        .electric-hit {
            animation: spark-burst 0.2s ease-out, jitter 0.1s linear infinite;
            z-index: 50;
        }

        /* ì „ê¸° ì…ì íš¨ê³¼ */
        .spark-particle {
            position: absolute;
            background: #ccff00;
            width: 2px;
            height: 8px;
            border-radius: 2px;
            pointer-events: none;
            z-index: 60;
            box-shadow: 0 0 8px #ccff00;
        }

        /* ë¼ì´ë” ê´‘ì±„ íš¨ê³¼ */
        .rider-glow {
            box-shadow: 0 0 15px #ccff00, inset 0 0 10px #ccff00;
        }

        /* ë²ˆì©ì´ëŠ” ë„¤ì˜¨ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes neon-pulse {
            0%, 100% { border-color: #ccff00; box-shadow: 0 0 15px #ccff00; }
            50% { border-color: #fff; box-shadow: 0 0 30px #ccff00, 0 0 10px #fff; }
        }
        .active-scan {
            animation: neon-pulse 1s infinite ease-in-out;
            border-width: 4px !important;
        }

        /* ì¹¸ ë‚´ë¶€ ìŠ¤ìº”ë¼ì¸ íš¨ê³¼ */
        @keyframes scan-move {
            0% { top: -10%; }
            100% { top: 110%; }
        }
        .scan-line {
            position: absolute;
            left: 0; width: 100%; height: 20%;
            background: linear-gradient(to bottom, transparent, rgba(204, 255, 0, 0.4), transparent);
            animation: scan-move 2s linear infinite;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px) rotate(-2deg); }
            75% { transform: translateX(8px) rotate(2deg); }
        }
        .shake { animation: shake 0.4s ease-in-out 2; }
        
        @keyframes blink {
            0%, 100% { background-color: #333; }
            50% { background-color: #ff0033; }
        }
        .blink-warning { animation: blink 0.8s ease-in-out infinite; border-color: #ff0033 !important;}

        @keyframes rising-kick {
            0% { transform: translate(120vw, -20vh) rotate(-15deg); opacity: 1; }
            30% { transform: translate(20vw, 5vh) rotate(-10deg); opacity: 1; }
            100% { transform: translate(-150vw, 40vh) rotate(-5deg); opacity: 0; }
        }
        .animate-kick {
            animation: rising-kick 0.8s cubic-bezier(0.15, 0, 0.15, 1) forwards;
            display: block !important;
        }

        .status-container {
            position: absolute;
            inset: 0;
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            background-color: #000;
        }
        .status-img { width: 100%; height: 100%; object-fit: cover; }
        .waiting-img { opacity: 0.8; object-fit: contain; padding: 5%; }
        .hacked-guide-img { filter: grayscale(0.5) sepia(0.5) hue-rotate(-50deg); opacity: 0.9; }

        #kick-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100; display: none;
        }
        
        /* ë²„íŠ¼ í„°ì¹˜ ì´í™íŠ¸ */
        .btn-press:active { 
            transform: scale(0.9); 
            background-color: #ccff00 !important;
            color: #000 !important;
            box-shadow: 0 0 30px #ccff00;
        }
        
        #security-notice {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 9999; display: none; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body class="flex flex-col h-screen w-full select-none text-white">

    <!-- ë³´ì•ˆ ì•ˆë‚´ì°½ -->
    <div id="security-notice">
        <div class="bg-gray-900 border-4 border-red-500 p-6 rounded-2xl max-w-sm">
            <h3 class="text-xl font-black text-red-500 mb-4">ğŸš¨ ë³´ì•ˆ ì°¨ë‹¨ ê°ì§€</h3>
            <p class="text-sm text-gray-300 mb-6">
                ì¸í„°ë„· ì£¼ì†Œ(quasaryeo.github.io)ë¥¼ í†µí•´ ì ‘ì†í•´ì•¼ë§Œ ì •ìƒì ì¸ ë¼ì´ë” ì´í™íŠ¸ê°€ ì‘ë™í•©ë‹ˆë‹¤.
            </p>
            <button onclick="document.getElementById('security-notice').style.display='none'" class="bg-red-500 text-white font-bold py-3 px-8 rounded-full">í™•ì¸</button>
        </div>
    </div>

    <div id="kick-overlay">
        <img src="zero-one-kick.png" onerror="this.style.display='none'" class="w-80 h-auto absolute top-1/4 right-0">
    </div>

    <!-- ì˜¤ë””ì˜¤ -->
    <audio id="bgm" loop><source src="bgm.mp3" type="audio/mpeg"></audio>
    <audio id="snd-click"><source src="click.mp3" type="audio/mpeg"></audio>
    <audio id="snd-correct"><source src="correct.mp3" type="audio/mpeg"></audio>
    <audio id="snd-error"><source src="error.mp3" type="audio/mpeg"></audio>
    <audio id="snd-kick"><source src="kick.mp3" type="audio/mpeg"></audio>

    <div id="game-view" class="w-full h-full flex flex-col bg-black relative">
        <!-- ìƒë‹¨ ë°” -->
        <div class="bg-gray-900 p-3 relative border-b-2 border-neon-yellow flex-shrink-0">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-lg font-black neon-yellow tracking-tighter text-sm uppercase italic">âš¡ ì œë¡œì› ë¯¸ì…˜ ì»¨íŠ¸ë¡¤</h2>
                <button onclick="toggleAudio()" id="audio-btn" class="bg-gray-800 p-2 rounded-full border border-neon-yellow btn-press shadow-[0_0_10px_rgba(204,255,0,0.5)]">
                    <span id="audio-icon">ğŸ”‡</span>
                </button>
            </div>
            
            <div class="flex items-center gap-3 bg-white p-2 rounded-xl shadow-[inset_0_0_15px_rgba(0,0,0,0.5)] border-2 border-neon-yellow relative overflow-hidden">
                <img src="izu.png" id="img-izu" onerror="handleImageError(this, 'izu.png')" alt="ì´ì¦ˆ" class="w-14 h-14 object-cover rounded-full border-2 border-gray-800 shadow-md z-10 bg-gray-200">
                <div class="z-10 w-full relative">
                    <div class="text-[10px] font-bold text-gray-500">ë¹„ì„œ ì´ì¦ˆì˜ í†µì‹ :</div>
                    <div id="mission-text" class="text-xs sm:text-sm font-black leading-tight text-black break-keep"></div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ê²Œì„ -->
        <div class="p-2 flex flex-col flex-grow justify-around gap-2 overflow-y-auto">
            <div id="feedback-msg" class="flex items-center justify-center text-center text-[11px] font-bold h-10 text-gray-400 px-2 rounded-lg leading-tight uppercase tracking-widest">
                í”„ë¡œê·¸ë¼ì´ì¦ˆ ëŒ€ê¸° ì¤‘...
            </div>

            <!-- ìë¦¬ìˆ˜ ë°© -->
            <div class="grid grid-cols-5 gap-1.5 w-full max-w-lg mx-auto px-1">
                <script>
                    const placesList = ['ë§Œ', 'ì²œ', 'ë°±', 'ì‹­', 'ì¼'];
                    const colors = ['bg-red-800', 'bg-blue-800', 'bg-green-800', 'bg-yellow-700', 'bg-purple-800'];
                    const keys = ['key-man.png', 'key-cheon.png', 'key-baek.png', 'key-sip.png', 'key-il.png'];
                    
                    placesList.forEach((p, i) => {
                        document.write(`
                            <button onclick="selectRoom('${p}', this)" id="room-${p}" class="room-btn relative flex flex-col h-32 bg-gray-900 border-2 border-gray-700 rounded-lg overflow-hidden shadow-lg transition-all btn-press">
                                <div id="scan-${p}"></div>
                                <img src="${keys[i]}" onerror="handleImageError(this, '${keys[i]}')" class="absolute inset-0 w-full h-full object-contain opacity-20 pointer-events-none mix-blend-screen">
                                <div class="${colors[i]} text-white text-center py-1 text-[10px] font-black w-full relative z-10 italic border-b border-black/50">${p}</div>
                                <div class="flex-grow flex items-center justify-center text-4xl font-black text-white relative z-10 w-full drop-shadow-[0_0_8px_rgba(255,255,255,0.5)]" id="val-${p}"></div>
                            </button>
                        `);
                    });
                </script>
            </div>

            <!-- ë„˜íŒ¨ë“œ -->
            <div id="keypad" class="hidden flex-col items-center w-full max-w-xs mx-auto bg-gray-900/80 p-3 rounded-2xl shadow-[0_0_20px_rgba(204,255,0,0.2)] border-2 border-neon-yellow/50 my-1 backdrop-blur-sm">
                <div class="grid grid-cols-3 gap-3 w-full">
                    <script>
                        for(let i=1; i<=9; i++){
                            document.write(`<button onclick="inputNumber('${i}', this)" class="h-14 bg-black border-2 border-gray-600 rounded-xl text-2xl font-black text-white btn-press hover:border-neon-yellow transition-colors">${i}</button>`);
                        }
                    </script>
                    <button onclick="inputNumber('0', this)" class="col-start-2 h-14 border-4 border-black rounded-full bg-neon-yellow shadow-[0_0_15px_rgba(204,255,0,0.6)] relative overflow-hidden flex items-center justify-center btn-press">
                        <img src="zero-one-logo.png" onerror="handleImageError(this, 'zero-one-logo.png')" class="absolute h-[85%] w-[85%] object-contain">
                    </button>
                </div>
            </div>

            <div class="w-full max-w-xs mx-auto">
                <button onclick="checkAnswer(this)" id="btn-submit" class="bg-neon-yellow text-black font-black text-xl py-4 rounded-xl shadow-[0_0_20px_rgba(204,255,0,0.5)] w-full btn-press border-2 border-black uppercase italic tracking-tighter">
                    ìŠ¹ì¸ ë° í”„ë¡œê·¸ë¼ì´ì¦ˆ!
                </button>
            </div>
            
            <!-- ì„±ê³µ í™”ë©´ -->
            <div id="result-box" class="hidden flex-col items-center justify-center gap-1 bg-gray-900 p-4 rounded-xl border-4 border-neon-yellow relative overflow-hidden h-40 shadow-[0_0_40px_rgba(204,255,0,0.4)]">
                <img src="zero-one.png" onerror="handleImageError(this, 'zero-one.png')" class="absolute -right-2 -bottom-2 h-36 object-contain opacity-50 z-0 pointer-events-none">
                <div class="z-10 text-center w-full">
                    <div class="text-lg font-black neon-yellow italic drop-shadow-md uppercase tracking-widest">ë¼ì´ì§• ì„íŒ©íŠ¸!</div>
                    <div id="final-number" class="text-5xl font-black tracking-[0.2em] text-white my-2 drop-shadow-[0_0_15px_rgba(204,255,0,1)]"></div>
                    <button onclick="startNewMission(this)" class="bg-neon-yellow text-black text-xs font-black py-2.5 px-8 rounded-full shadow-md btn-press uppercase">ë‹¤ìŒ ë¯¸ì…˜ ì¶œë™!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMission = {};
        let currentAnswers = { 'ë§Œ': '', 'ì²œ': '', 'ë°±': '', 'ì‹­': '', 'ì¼': '' };
        let selectedRoom = null;
        let audioEnabled = false;
        const places = ['ë§Œ', 'ì²œ', 'ë°±', 'ì‹­', 'ì¼'];
        const bgm = document.getElementById('bgm');
        
        // ì „ê¸° ìŠ¤íŒŒí¬ ìƒì„± í•¨ìˆ˜
        function triggerElectricity(element) {
            if (!element) return;
            
            // ë²„íŠ¼ì— ì „ê¸° í´ë˜ìŠ¤ ì¶”ê°€
            element.classList.add('electric-hit');
            setTimeout(() => element.classList.remove('electric-hit'), 200);

            // ìŠ¤íŒŒí¬ íŒŒí‹°í´ ìƒì„±
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'spark-particle';
                
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                
                const angle = Math.random() * Math.PI * 2;
                const dist = 20 + Math.random() * 40;
                const tx = Math.cos(angle) * dist;
                const ty = Math.sin(angle) * dist;
                const rot = angle * (180 / Math.PI);

                document.body.appendChild(particle);

                particle.animate([
                    { transform: `translate(-50%, -50%) rotate(${rot}deg) translate(0, 0) scaleY(1)`, opacity: 1 },
                    { transform: `translate(-50%, -50%) rotate(${rot}deg) translate(${tx}px, ${ty}px) scaleY(0.2)`, opacity: 0 }
                ], {
                    duration: 300 + Math.random() * 200,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        function handleImageError(img, filename) {
            img.src = `https://placehold.co/200x200/222/ccff00?text=${filename}`;
        }

        function playSfx(audioObj) {
            if (!audioEnabled) return;
            audioObj.currentTime = 0;
            audioObj.play().catch(e => console.warn(e));
        }

        function toggleAudio() {
            const icon = document.getElementById('audio-icon');
            if (!audioEnabled) {
                bgm.play().then(() => {
                    icon.innerText = "ğŸ”Š";
                    audioEnabled = true;
                }).catch(e => console.error(e));
            } else {
                bgm.pause();
                icon.innerText = "ğŸ”‡";
                audioEnabled = false;
            }
        }

        function numberToKorean(valObj) {
            const units = ['', 'ì‹­', 'ë°±', 'ì²œ', 'ë§Œ'];
            const nums = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            let result = '';
            const order = ['ì¼', 'ì‹­', 'ë°±', 'ì²œ', 'ë§Œ'];
            for (let i = 4; i >= 0; i--) {
                const digit = valObj[order[i]];
                if (digit > 0) result += nums[digit] + units[i] + ' ';
            }
            return result.trim();
        }

        function setGuideHumagear(place, isHacked) {
            const el = document.getElementById('val-' + place);
            if (isHacked) {
                el.innerHTML = `<div class="status-container"><img src="hacked-humagear.png" onerror="handleImageError(this, 'hacked-humagear.png')" class="status-img waiting-img hacked-guide-img"></div>`;
            } else {
                const randIdx = Math.floor(Math.random() * 15) + 1;
                el.innerHTML = `<div class="status-container"><img src="h${randIdx}.webp" onerror="handleImageError(this, 'h${randIdx}.webp')" class="status-img waiting-img"></div>`;
            }
        }

        function startNewMission(el) {
            if (el) triggerElectricity(el);
            playSfx(document.getElementById('snd-click'));
            currentAnswers = { 'ë§Œ': '', 'ì²œ': '', 'ë°±': '', 'ì‹­': '', 'ì¼': '' };
            selectedRoom = null;
            document.getElementById('keypad').classList.add('hidden');
            document.getElementById('result-box').classList.add('hidden');
            document.getElementById('btn-submit').classList.remove('hidden');
            
            document.getElementById('feedback-msg').innerHTML = `í•´í‚¹ëœ íœ´ë¨¸ê¸°ì–´ ê²€ìƒ‰ ì¤‘...`;
            document.getElementById('feedback-msg').classList.remove('neon-yellow');

            currentMission = {};
            currentMission['ë§Œ'] = Math.floor(Math.random() * 9) + 1;
            let others = ['ì²œ', 'ë°±', 'ì‹­', 'ì¼'];
            let rem = Math.floor(Math.random() * 2) + 1; 
            others.sort(() => 0.5 - Math.random());
            others.slice(rem).forEach(p => currentMission[p] = Math.floor(Math.random() * 9) + 1);
            others.slice(0, rem).forEach(p => currentMission[p] = 0);

            places.forEach(p => {
                const btn = document.getElementById('room-' + p);
                btn.classList.remove('active-scan', 'blink-warning');
                btn.classList.add('border-gray-700');
                document.getElementById('scan-' + p).classList.remove('scan-line');
                setGuideHumagear(p, currentMission[p] === 0);
            });

            const mode = Math.random() > 0.5 ? 'PLACE' : 'READ';
            const txt = document.getElementById('mission-text');
            if (mode === 'PLACE') {
                let pArr = [];
                places.forEach(p => { if (currentMission[p] !== 0) pArr.push(`${p}: ${currentMission[p]}`); });
                txt.innerHTML = `ì—¬ì£¼ì™„ ì‚¬ì¥ë‹˜! <strong>${pArr.join(', ')}</strong> ë°ì´í„°ë¥¼ ìŠ¹ì¸í•´ ì£¼ì„¸ìš”!`;
            } else {
                txt.innerHTML = `ì—¬ì£¼ì™„ ì‚¬ì¥ë‹˜! <strong>"${numberToKorean(currentMission)}"</strong> ë°ì´í„°ë¥¼ ì™„ì„±í•˜ì„¸ìš”!`;
            }
        }

        function selectRoom(place, el) {
            triggerElectricity(el);
            playSfx(document.getElementById('snd-click'));
            selectedRoom = place;
            document.getElementById('keypad').classList.replace('hidden', 'flex');
            
            places.forEach(p => {
                const btn = document.getElementById('room-' + p);
                btn.classList.remove('active-scan', 'blink-warning');
                btn.classList.replace('border-neon-yellow', 'border-gray-700');
                document.getElementById('scan-' + p).classList.remove('scan-line');
            });
            
            const selectedBtn = document.getElementById('room-' + place);
            selectedBtn.classList.add('active-scan');
            document.getElementById('scan-' + place).classList.add('scan-line');
            
            document.getElementById('feedback-msg').innerHTML = `<span class="neon-yellow font-black">[${place}] ì‹œìŠ¤í…œì— ì ‘ì† ì¤‘...</span>`;
        }

        function inputNumber(num, el) {
            triggerElectricity(el);
            playSfx(document.getElementById('snd-click'));
            if (!selectedRoom) return;
            currentAnswers[selectedRoom] = num;
            const displayEl = document.getElementById('val-' + selectedRoom);
            if (num === '0') {
                displayEl.innerHTML = `<div class="status-container"><img src="zero-one-holding-0.png" onerror="handleImageError(this, 'zero-one-holding-0.png')" class="status-img"></div>`;
            } else {
                displayEl.innerHTML = `<span class="text-white text-5xl font-black drop-shadow-[0_0_10px_rgba(204,255,0,0.8)]">${num}</span>`;
            }
        }

        function triggerKickAnimation(callback) {
            playSfx(document.getElementById('snd-kick'));
            const overlay = document.getElementById('kick-overlay');
            overlay.classList.add('animate-kick');
            overlay.onanimationend = () => {
                overlay.classList.remove('animate-kick');
                callback();
            };
        }

        function checkAnswer(el) {
            triggerElectricity(el);
            let empty = [];
            places.forEach(p => { if (currentAnswers[p] === '') empty.push(p); });
            
            if (empty.length > 0) {
                playSfx(document.getElementById('snd-error'));
                empty.forEach(p => {
                    document.getElementById('room-' + p).classList.add('blink-warning');
                    document.getElementById('val-' + p).innerHTML = `<div class="status-container"><img src="hacked-humagear.png" class="status-img"></div>`;
                });
                document.getElementById('game-view').classList.add('shake');
                setTimeout(() => document.getElementById('game-view').classList.remove('shake'), 500);
                document.getElementById('feedback-msg').innerHTML = `<span class="text-red-500 font-black">ì‹¬ê°í•œ ì˜¤ë¥˜: ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!</span>`;
                return;
            }

            let correct = true;
            places.forEach(p => { if (parseInt(currentAnswers[p]) !== currentMission[p]) correct = false; });

            if (correct) {
                playSfx(document.getElementById('snd-correct'));
                triggerKickAnimation(() => {
                    document.getElementById('keypad').classList.add('hidden');
                    document.getElementById('btn-submit').classList.add('hidden');
                    document.getElementById('result-box').classList.replace('hidden', 'flex');
                    document.getElementById('final-number').innerText = places.map(p => currentAnswers[p]).join('');
                    document.getElementById('feedback-msg').innerHTML = `<span class="neon-yellow font-black">ë¯¸ì…˜ ì™„ë£Œ: ë°ì´í„° í”„ë¡œê·¸ë¼ì´ì¦ˆ!</span>`;
                });
            } else {
                playSfx(document.getElementById('snd-error'));
                document.getElementById('feedback-msg').innerHTML = `<span class="text-orange-500 font-black">ì˜¤ë¥˜: ë°ì´í„° ë¶ˆì¼ì¹˜</span>`;
                document.getElementById('game-view').classList.add('shake');
                setTimeout(() => document.getElementById('game-view').classList.remove('shake'), 500);
            }
        }

        window.onload = () => startNewMission();
    </script>
</body>
</html>
